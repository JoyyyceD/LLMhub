# 每日数据流水线（V1）

## 1. 调度策略

- 执行频率：每天 1 次
- 执行时间：北京时间 08:00
- 触发方式：定时任务（建议 GitHub Actions）

## 2. 流水线步骤

1. 拉取 AA 数据
2. 拉取 OR 数据
3. 拉取当日汇率快照（USD->CNY）
4. 按别名与核心 key 合并
5. 生成合并文件
6. 过滤候选：`has_aa = true AND has_or = true`
7. 执行核心字段校验
8. 发布可用快照

## 3. 增量与快照

- 输入为“每天一份新文件”
- 每次生成独立 `record_date` 快照
- 在线推荐默认读取最新可用快照

## 4. 缺失策略（严格模式）

- 核心字段缺失：直接跳过该模型
- 不做缺失填 0
- 不做自动回填旧值
- 跳过必须记录原因，供运维排查

汇率缺失策略：

- 当日汇率请求失败时，优先使用前一天汇率
- 若前一天不可用，再使用最近一次有效汇率
- 标记 `fx_stale = true`
- 发送告警

## 5. 失败处理

- 抓取失败：任务标记失败并告警
- 合并结果为空：不覆盖上一份有效文件
- 字段结构异常：任务失败并告警

## 6. 质量监控指标

- 每日抓取成功率
- 当日候选数（`has_aa && has_or`）
- 严格模式跳过数量
- 与昨日相比的候选变化比例
